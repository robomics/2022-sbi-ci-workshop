name: 011 - Installing software on GHA

on:
  push:
    branches: [ main, gha-devel ]
    paths: [ ".github/workflows/011*.yml" ]

jobs:
  installing-sw:
    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest]

    runs-on: ${{ matrix.os }}

    # Workaround for conda activate not working
    defaults:
      run:
        shell: bash -l {0}

    steps:
      - name: Install samtools using apt-get (Ubuntu)
        if: ${{ startsWith(matrix.os, 'ubuntu') }}
        run: |
          sudo apt-get update
          sudo apt-get install -y samtools

      - name: Install samtools using homebrew (macOS)
        if: ${{ startsWith(matrix.os, 'macos') }}
        run: |
          brew install samtools
          
      - name: Test samtools (system)
        run: |
          which samtools
          samtools --version

      - name: Setup conda
        # Setup conda using the setup-miniconda action
        uses: conda-incubator/setup-miniconda@v2
        with:
          miniconda-version: "latest"
          channels: bioconda, conda-forge, defaults
          use-only-tar-bz2: true
          auto-update-conda: true
          auto-activate-base: true

      - name: Install samtools using conda
        run: conda create -y --name samtools samtools

      - name: Test samtools (conda)
        run: |
          conda activate samtools
          
          which samtools
          samtools --version
